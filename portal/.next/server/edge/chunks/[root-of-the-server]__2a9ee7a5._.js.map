{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Documents/portal/src/middleware.ts"],"sourcesContent":["import { NextResponse, type NextRequest } from 'next/server';\nimport { createServerClient } from '@supabase/auth-helpers-nextjs';\n\nexport async function middleware(req: NextRequest) {\n  const url = req.nextUrl.clone();\n  const res = NextResponse.next();\n\n  // Only guard /portal/*\n  if (!url.pathname.startsWith('/portal')) {\n    return res;\n  }\n\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        get(name: string) {\n          return req.cookies.get(name)?.value;\n        },\n        set(name: string, value: string, options: any) {\n          res.cookies.set({ name, value, ...options });\n        },\n        remove(name: string, options: any) {\n          res.cookies.set({ name, value: '', ...options });\n        },\n      },\n    }\n  );\n\n  const {\n    data: { session },\n  } = await supabase.auth.getSession();\n\n  if (!session) {\n    url.pathname = '/login';\n    return NextResponse.redirect(url);\n  }\n\n  // Check admin membership via RLS\n  const { data: admins } = await supabase\n    .from('admins')\n    .select('user_id, is_active')\n    .eq('user_id', session.user.id)\n    .eq('is_active', true)\n    .limit(1);\n\n  if (!admins || admins.length === 0) {\n    url.pathname = '/unauthorized';\n    return NextResponse.rewrite(url);\n  }\n\n  return res;\n}\n\nexport const config = {\n  matcher: ['/portal/:path*'],\n};\n\n\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEO,eAAe,WAAW,GAAgB;IAC/C,MAAM,MAAM,IAAI,OAAO,CAAC,KAAK;IAC7B,MAAM,MAAM,uNAAY,CAAC,IAAI;IAE7B,uBAAuB;IACvB,IAAI,CAAC,IAAI,QAAQ,CAAC,UAAU,CAAC,YAAY;QACvC,OAAO;IACT;IAEA,MAAM,WAAW,IAAA,6NAAkB,sUAGjC;QACE,SAAS;YACP,KAAI,IAAY;gBACd,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,OAAO;YAChC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAY;gBAC3C,IAAI,OAAO,CAAC,GAAG,CAAC;oBAAE;oBAAM;oBAAO,GAAG,OAAO;gBAAC;YAC5C;YACA,QAAO,IAAY,EAAE,OAAY;gBAC/B,IAAI,OAAO,CAAC,GAAG,CAAC;oBAAE;oBAAM,OAAO;oBAAI,GAAG,OAAO;gBAAC;YAChD;QACF;IACF;IAGF,MAAM,EACJ,MAAM,EAAE,OAAO,EAAE,EAClB,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;IAElC,IAAI,CAAC,SAAS;QACZ,IAAI,QAAQ,GAAG;QACf,OAAO,uNAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,iCAAiC;IACjC,MAAM,EAAE,MAAM,MAAM,EAAE,GAAG,MAAM,SAC5B,IAAI,CAAC,UACL,MAAM,CAAC,sBACP,EAAE,CAAC,WAAW,QAAQ,IAAI,CAAC,EAAE,EAC7B,EAAE,CAAC,aAAa,MAChB,KAAK,CAAC;IAET,IAAI,CAAC,UAAU,OAAO,MAAM,KAAK,GAAG;QAClC,IAAI,QAAQ,GAAG;QACf,OAAO,uNAAY,CAAC,OAAO,CAAC;IAC9B;IAEA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAiB;AAC7B"}}]
}